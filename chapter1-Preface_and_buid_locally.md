# React æºç é˜…è¯»ï¼ˆåºï¼‰ï½œå†™åœ¨å‰é¢&æœ¬åœ° build

ä¸çŸ¥å“ªåˆ»çƒ­è¡€ä¸Šå¤´ï¼Œä¿¡èª“æ—¦æ—¦ï¼Œæƒ³æ‹¿ä¸‹`React`æºç ï¼Œé‚æ¿€åŠ¨åœ°æ‰“å¼€[æºç ](https://github.com/facebook/react)ï¼Œå¾…ç¿»é˜…ç‰‡åˆ»ï¼Œæ€ç»ªå¹³å®šï¼Œä¸ç¦è‡ªé—®ï¼Œæºç æµ©ç€šï¼Œä»ä½•å¼€å§‹ï¼Ÿæ€ç´¢æ— æœï¼Œå…´è‡´æ¸æ— ï¼Œæš—è‡ªå®½æ…°ï¼Œä¸‹æ¬¡ä¸€å®šã€‚ã€‚ã€‚ä¸ºäº†ä¸å†é™·äºä¼Šé‚ªé‚£ç¾ï¼Œå†³å®šç°åœ¨å¼€å§‹æœ‰è®¡åˆ’åœ°å­¦ä¹ ï¼Œé¡ºä¾¿è®°å½•ä¸‹æ¥è‡ªå·±å­¦ä¹ æºç çš„ä¸€äº›ç»éªŒå†ç¨‹ã€‚

## å†™åœ¨å‰é¢

æºç å¾ˆå¤§ï¼Œè¦æœ‰è®¡åˆ’ï¼Œä¸ç„¶ä¼šåƒæ— å¤´çš„è‹è‡ï¼Œé™·äºæµ©ç€šæºç ä¸­ä¸èƒ½è‡ªæ‹”ã€‚æ¯”å¦‚æˆ‘ç›®å‰çš„ä¸€äº›è®¡åˆ’ï¼šè¦å¼„æ‡‚ React æ•´ä½“é€»è¾‘æ¶æ„ï¼ˆå®Œæ•´çš„`Render`æ¸²æŸ“æµç¨‹ï¼‰ï¼Œä¸»è¦æ³¨é‡ä»£ç çš„è¿è¡Œé€»è¾‘é¡ºåºï¼Œå¾ˆå¤šç»†èŠ‚æ²¡å¿…è¦é”±é“¢å¿…è¾ƒï¼Œåè€Œå¯èƒ½ä¼šé™ä½å­¦ä¹ å…´è¶£ã€‚è¦å¼„æ‡‚` Virtual Dom Diff`ç®—æ³•ï¼Œé‚£ä¹ˆæ‰¾åˆ°å¯¹åº”çš„éƒ¨é—¨æºç ç»†è¯»å°±è¡Œï¼›å†æ¯”å¦‚ï¼Œæƒ³ææ‡‚`Hooks`åŸç†ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶å»çœ‹åœ¨`mount`å’Œ`update`é˜¶æ®µåˆ†åˆ«éƒ½åšäº†å•¥ï¼Œä»¥åŠé’©å­çš„ä¾èµ–é¡¹æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„ç­‰ç­‰ã€‚æ€»ä¹‹ï¼Œè¦æœ‰è®¡åˆ’ï¼Œè¦æœ‰çš„æ”¾çŸ¢ã€‚

## å¼€å‘å›¢é˜Ÿ Dan ç¥çš„å»ºè®®

å°±åƒæ˜¯æƒ³è¯»æ‡‚ä¸€æœ¬ä¹¦ï¼Œæœ‰å¿…è¦äº†è§£ä½œè€…çš„èƒŒæ™¯å’Œæ€æƒ³ä¸€æ ·ã€‚æƒ³è¦ææ‡‚`React`ï¼Œæˆ‘è§‰å¾—æ ¸å¿ƒå¼€å‘å›¢é˜Ÿçš„åˆ†äº«æ˜¯æœ€ä½³çš„ç¬¬ä¸€æ‰‹åŸå‘³èµ„æ–™ã€‚

è¿™é‡Œæƒ³å…ˆåˆ†äº«ä¸‹ä½œä¸º`React.js` çš„æ ¸å¿ƒå¼€å‘è€…ï¼ŒåŒæ—¶æ˜¯ `Redux.js` çŠ¶æ€ç®¡ç†å·¥å…·çš„ä½œè€… `Dan Abramov` å¯¹äºå­¦ä¹ è€…çš„å»ºè®®ã€‚ï¼ˆä»¥ä¸‹æ‘˜è‡ªå¤§ä½¬çš„[è®¿è°ˆ](https://mp.weixin.qq.com/s/SBVE34dW9g4BsabmLJV9wg)ï¼‰

> **ä¸»æŒäººï¼šå¾ˆå¤šæœ‹å‹å¯¹ä½ çš„ä¸ªäººç»å†æ„Ÿå…´è¶£ï¼Œä½ åˆšåŠ å…¥ Facebook çš„æ—¶å€™æ˜¯å¦‚ä½•å­¦ä¹  React çš„ç»“æ„ã€æ¦‚å¿µï¼Œå¹¶æ…¢æ…¢å¼€å§‹è´¡çŒ®ä»£ç çš„å‘¢ï¼Ÿ**
>
> Danï¼šæ•´ä¸ªæµç¨‹æœ€å…³é”®æ˜¯è¦ç†Ÿæ‚‰æ¶æ„ï¼Œä¸€æ—¦ä½ å¯¹æ•´ä¸ªé¡¹ç›®çš„æ¶æ„æœ‰äº†å……åˆ†çš„äº†è§£ï¼Œæ¥ä¸‹æ¥çš„æ‰€æœ‰å·¥ä½œå°±éƒ½é¡ºç†æˆç« äº†ã€‚æœ‰ä¸€ä¸ªå¯¹æˆ‘å¸®åŠ©å¾ˆå¤§çš„ç‚¹ï¼Œé‚£å°±æ˜¯å»æŸ¥çœ‹äººä»¬çš„ `Issue`ï¼Œå¹¶å»è§£å†³ä»–ä»¬ã€‚æˆ‘æƒ³æˆ‘ä¸ªäººå¯èƒ½å·²ç»çœ‹äº†æ•°åƒä¸ª Issue äº†ï¼Œå¦‚æœä½ æƒ³è¦å¿«é€Ÿä¸Šæ‰‹é¡¹ç›®çš„è¯ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„å­¦ä¹ æ–¹å¼ã€‚ä½ å¯ä»¥ç‚¹å‡»æŸ¥çœ‹å¤„äºã€ŒOpenã€çŠ¶æ€çš„ Issueï¼Œåº”è¯¥å·®ä¸å¤šæœ‰ 500 ä¸ªï¼Œä½ å¯ä»¥ä»å¤´çœ‹ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ°æœ€åä¸€é¡µä»æœ€è€çš„é‚£ä¸ªå¼€å§‹çœ‹ã€‚é€šè¿‡çœ‹ Issue ä½ é€æ¸å°±èƒ½ç†è§£å½“å‰æœ‰å“ªäº›é—®é¢˜ï¼Œæ…¢æ…¢åœ°å»ç†è§£ä»£ç ï¼Œç†è§£é¡¹ç›®çš„æ›´æ–°å†å²ç­‰ç­‰ï¼Œæ‰€ä»¥è¿™å°±æ˜¯é€šè¿‡ Issue å­¦ä¹ çš„æ–¹æ³•ã€‚

> **ä¸»æŒäººï¼šä½œä¸ºä¸€ä¸ªä½¿ç”¨ React çš„å‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦å»é˜…è¯» React åº“çš„æºç å—ï¼Ÿå¦‚æœéœ€è¦çš„è¯ï¼Œæœ‰æ²¡æœ‰å¥½çš„é˜…è¯»ä»£ç çš„æ–¹å¼ï¼Ÿ**
>
> Danï¼šæˆ‘è§‰å¾—æ²¡æœ‰å¿…è¦ï¼Œè¿™å¯èƒ½ä¼šæ˜¯ä¸€é¡¹ç›¸å½“å›°éš¾çš„å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨ä»»ä½•å…¶ä»–åœ°æ–¹æåŠ React è‡ªèº«çš„æ¶æ„æ˜¯æ€æ ·è®¾è®¡çš„ã€‚å¦‚æœä½ ä¸Šæ¥å°±å¼€å§‹è¯»ä»£ç ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°éå¸¸å›°æƒ‘ï¼Œä¸æ˜ç™½ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ã€‚è¿™å¯èƒ½ä¹Ÿæ˜¯æˆ‘ä»¬å°†æ¥éœ€è¦æ”¹è¿›çš„ä¸€ç‚¹ï¼Œå°†æ¥åˆ°äº†æŸä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»è§£é‡Šè¿™é‡Œé¢çš„å®ç°åŸç†ã€‚ä½†æˆ‘è§‰å¾—å¦‚æœä½ åªæ˜¯æƒ³ç©ç©çš„è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹åº”è¯¥ä¹Ÿç®—ä¸ä¸Šç—›è‹¦ã€‚æ¯”å¦‚æˆ‘è‡ªå·±å°±å¾ˆå–œæ¬¢åšä¸€ä»¶äº‹ï¼Œç”¨ `debugger` çš„æ­¥è¿›åŠŸèƒ½ï¼ˆ`step-in`) æ¥ä¸€è¡Œè¡Œè·‘ä»£ç ï¼Œçœ‹çœ‹ä»£ç ä¼šè·‘åˆ°å“ªä¸ªå‡½æ•°ï¼Œè¿è¡Œä»£ç ä¼šç”¨åˆ°å“ªäº›ä¸åŒçš„æ–‡ä»¶ã€‚å¦ä¸€ä»¶ä½ å¯ä»¥åšçš„äº‹æ˜¯ä½¿ç”¨ `Chrome Performance Tools`ï¼Œä½ å¯ä»¥æ‰“å¼€ `Chrome` çš„ `Performance Tab`ï¼Œç‚¹å‡»å½•åˆ¶ï¼Œç„¶ååœ¨ä½ çš„åº”ç”¨ä¸­è¿›è¡Œä¸€äº›æ“ä½œï¼Œä¹‹åç‚¹å‡»åœæ­¢ï¼Œä½ ä¼šçœ‹åˆ°ä¸€å¼ ç«ç„°å›¾æˆ–è€…ç«ç„°è¡¨ã€‚è¿™ä¸ªåˆ†æç»“æœéå¸¸æœ‰ç”¨ï¼Œå®ƒå°±åƒæ˜¯æŸç§å †æ ˆï¼Œä½ å¯ä»¥çœ‹åˆ°å‡½æ•°çš„è°ƒç”¨é¡ºåºï¼Œçœ‹åˆ°ä»£ç ä¸­æ­£åœ¨å‘ç”Ÿçš„äº‹ã€‚å®ƒå¸¸ç”¨æ¥æµ‹è¯•æ€§èƒ½ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½ ä»£ç ä¸­çš„å“ªä¸€éƒ¨åˆ†è¿è¡Œçš„æ¯”è¾ƒæ…¢ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥åšä¸€ä¸ªå½“å‰å‡½æ•°æ€»è§ˆï¼Œå› ä¸ºä¸Šé¢å±•ç¤ºäº†å‡½æ•°çš„åç§°ã€‚ä½ å¯ä»¥çœ‹åˆ°çŠ¶æ€å˜åŒ–ä¼šå¼•å‘å“ªäº›ä¸åŒçš„äº‹æƒ…ã€‚ä½ å¯èƒ½ä¼šå‘ç°ã€Œå“¦ï¼Ÿè¿™ä¸ªå‡½æ•°åœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½è¢«è°ƒç”¨äº†ï¼Œå®ƒæ˜¯åšä»€ä¹ˆçš„ï¼Ÿã€ã€‚ä¹‹åä½ å¯ä»¥ç‚¹è¿›å»ï¼Œçœ‹çœ‹é‡Œé¢åˆ°åº•æ‰§è¡Œäº†ä»€ä¹ˆã€‚æ²¿ç€è¿™ç§æ€§èƒ½æµ‹è¯•æ¥ä¸€æ­¥æ­¥æ¢ç´¢ä»£ç æˆ‘è§‰å¾—ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„å­¦ä¹ æ–¹å¼ï¼Œå¯ä»¥äº†è§£åˆ° React åœ¨å“ªéƒ¨åˆ†èŠ±äº†æ—¶é—´ï¼Œå“ªäº›å‡½æ•°æ˜¯å…¶æ ¸å¿ƒä¹‹ç±»çš„ã€‚

ç¨å¾®è·‘ä¸ªé¢˜ï¼ŒDan ç¥åœ¨è°ˆåˆ°ç»™å‰ç«¯å¼€å‘è€…çš„å­¦ä¹ å»ºè®®æ—¶è¯´ï¼šæ€»ç»“æ¥è¯´ï¼Œæˆ‘æ¨èä½ åšä¸€äº›ä½“é‡å°ï¼Œä½†æ˜¯æœ‰æ·±åº¦çš„ä¸œè¥¿ï¼Œç„¶åä»ä¸­è·å¾—æ”¶è·å§ã€‚æ¯”å¦‚åšä¸€ä¸ªäº•å­—æ£‹ï¼Œæˆ–è€…æ˜¯è´ªåƒè›‡ã€‚åšæ¸¸æˆä¼šæ¨åŠ¨ä½ å»æ€è€ƒï¼Œæ€è€ƒç¨‹åºå¦‚ä½•å»è®¾è®¡ï¼Œæ€è€ƒå¦‚ä½•å»è§£å†³é—®é¢˜ï¼Œè€Œè¿™ä¸€ç‚¹æ˜¯ä½ å¹³æ—¶å†™è¡¨å•ã€å†™ç•Œé¢æ‰€è®­ç»ƒä¸åˆ°çš„ã€‚æˆ‘è§‰å¾—è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¯å‘ï¼Œä»¥åçš„å­¦ä¹ è¾“å‡ºä¹Ÿå¯ä»¥ä»¥è¿™ç§æ–¹å¼ï¼Œåšä¸€äº›ä½“é‡å°ã€æœ‰æ·±åº¦çš„`demo`ã€‚

## React çš„ Monorepo ä»“åº“

React é‡‡ç”¨ `Monorepo` ä»“åº“æ¶æ„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªä»“åº“é‡ŒåŒ…å«äº†å¤šä¸ªå­ä»“åº“ï¼Œ`packages` ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°å¾ˆå¤šå•ç‹¬çš„ `package`ã€‚ä¾‹å¦‚æ¯”è¾ƒç†Ÿæ‚‰çš„ `react, react-dom, react-reconciler, scheduler`ç­‰ç­‰ã€‚å…³äºæºç çš„æ¦‚è¿°ï¼Œå¯ä»¥çœ‹è¿™ç¯‡[å®˜ç½‘æºç æ¦‚è¿°](https://zh-hans.reactjs.org/docs/codebase-overview.html)ã€‚

å¦å¤–ï¼Œæºç ä¸­ç»å¸¸ä¼šçœ‹è§åç¼€ `.old.js` æˆ–è€… `.new.js` è¿™ç§æ–‡ä»¶ï¼ŒDan ç¥æ˜¯è¿™ä¹ˆè¯´çš„:

> ä¸€ä¸ªæœ‰è¶£çš„ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¯”è¾ƒæœ‰äº‰è®®çš„ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬æœ‰å¾ˆå¤šæ–‡ä»¶éƒ½å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ã€‚å¦‚æœä½ çœ‹æºç çš„è¯ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬æœ‰ `.old.js` æˆ–è€… `.new.js` è¿™ç§æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åŸºæœ¬ä¸Šæ˜¯å¤åˆ¶ç²˜è´´å‡ºæ¥çš„ï¼Œå®ƒä»¬çš„å†…å®¹ä¹ŸåŸºæœ¬ç›¸åŒã€‚æˆ‘ä»¬ç”¨å®ƒä»¬æ¥æµ‹è¯•ä¸€äº›å¯èƒ½ä¼šå¸¦æ¥é£é™©æ›´æ–°ï¼Œå¯¹äº Facebook ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶éƒ¨ç½²å¤šä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬æœ‰æ—¶å€™ä¼šå°†è¿™äº›å®éªŒæ€§çš„æ›´æ–°å†™åˆ° `.new` æ–‡ä»¶é‡Œé¢ï¼Œç„¶ååœ¨ Facebook çš„å®éªŒç¯å¢ƒé‡Œé¢è¿›è¡Œå›å½’æµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•å„é¡¹æŒ‡æ ‡æ²¡æœ‰åŠ£åŒ–çš„è¯ï¼Œå†å°†è¿™äº›æ›´æ–°å¤åˆ¶åˆ° `.old` æ–‡ä»¶ä¸­å»ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬çš„ç½‘ç«™åœ¨ä»»ä½•æ—¶åˆ»éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ã€‚åœ¨å®éªŒæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥å»åšå…¶ä»–éƒ¨åˆ†çš„ä»£ç æäº¤ã€‚è¿™å¬ä¸Šå»å¯èƒ½æ¯”è¾ƒå¥‡æ€ªï¼Œä½†å®é™…ç”¨èµ·æ¥æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚

## ç¯å¢ƒé…ç½®

ç¯å¢ƒé…ç½®å› äººè€Œå¼‚ï¼Œå¯è‡ªè¡Œå¿½ç•¥ã€‚

å¹³æ—¶ç”¨æƒ¯äº†å…¬å¸çš„ `Mac`ï¼Œè¿™æ¬¡ç”¨è‡ªå·±ç ´æ—§çš„ `Windows` ç»™æˆ‘ä¸€é¡¿å¥½æŠ˜è…¾ï¼Œç»ˆäºæ‰¾å›äº†ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚

æˆ‘çš„é…ç½®ï¼š`Win10` + `WSL (Ubuntu22.04)` + `oh-my-zsh (å¾ˆçˆ±çš„ä¸»é¢˜ï¼šaf-magic)` + `VSCode (å®‰è£… Remote-WSL æ’ä»¶ç›´æ¥èµ·é£)` + `Git` + `Yarn` + `Nvm` + `Node16`ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c92c518294c474b9aa764591269e976~tplv-k3u1fbpfcp-watermark.image?)

**VSCode ç»ˆç«¯ï¼š**
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1b47d34b9bc443aa52829d6172f330f~tplv-k3u1fbpfcp-watermark.image?)

# æœ¬åœ° build æµç¨‹

ä¸ºäº†å¸®åŠ©å¼€å‘è€…æ›´å¿«ä¸Šæ‰‹æˆ–è€…è´¡çŒ®ä»£ç ï¼ŒReact æœ‰ä¸“é—¨çš„ Â **`Contribution Guide`**ï¼Œé‡Œé¢å°±æœ‰è®²æ€ä¹ˆåœ¨æœ¬åœ°æ„å»ºä»£ç ã€‚è¿™é‡Œçš„æ„å»ºæµç¨‹ä¹ŸåŸºæœ¬æ˜¯éµå¾ªå®˜ç½‘ [è´¡çŒ®æµç¨‹ Contributing Guide](https://reactjs.org/docs/how-to-contribute.html)ã€‚

è¿™é‡Œä¸»è¦ä»‹ç»æ„å»ºæºç çš„æœ¬åœ° `npm` åŒ…åæ­é… `create-react-app` (æˆ–è€…ä½ è‡ªå·±çš„ react é¡¹ç›®) æ¥ä½¿ç”¨ã€‚

1. `fork` å®˜æ–¹ä»“åº“åï¼Œ`clone` æ‹‰å–è‡ªå·±ä»“åº“ä»£ç ã€‚_ï¼ˆä¹Ÿå¯ç›´æ¥ clone å®˜æ–¹ä»“åº“ä»£ç ï¼‰_

```sh
# å®˜æ–¹ä»“åº“ä»£ç 
git clone https://github.com/facebook/react.git
```

2. `cd` è¿›å…¥æºç é¡¹ç›® `react/` æ–‡ä»¶å¤¹åï¼Œ`yarn` å®‰è£…é¡¹ç›®ä¾èµ–ã€‚æ¼«é•¿çš„ç­‰å¾…ã€‚ã€‚ã€‚

```sh
cd react
yarn
```

_å®‰è£…æˆªå›¾å¦‚ä¸‹ï¼Œå…¶ä¸­å½“å‰åˆ†æ”¯ `build-test` æ˜¯æˆ‘ä» `main` åˆ†æ”¯ä¸Šæ–°å»ºçš„åˆ†æ”¯ï¼š_
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfd281d25e2542deb7e7167aa2895372~tplv-k3u1fbpfcp-watermark.image?)

_`yarn` å®‰è£…ä¾èµ–é¡ºåˆ©å®Œæˆåä¼šæœ‰å¦‚ä¸‹æç¤ºï¼š_

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2bd2f10a91a488288c7db7139b09af7~tplv-k3u1fbpfcp-watermark.image?)

3. **ï¼ˆå¯é€‰æ­¥éª¤ï¼Œæ…é€‰ï¼‰** å®˜æ–¹æ¨èä½¿ç”¨ `yarn test` è¿è¡Œå•æµ‹ç”¨ä¾‹æ¥éªŒè¯é¡¹ç›®ä»£ç ï¼ˆæ…é€‰ï¼Œåˆæ˜¯æ¼«é•¿çš„ç­‰å¾…ï¼Œå°åŠä¸ªå°æ—¶ã€‚ã€‚ã€‚è·‘èµ·æ¥å†…å­˜å¹²æ»¡åŸºæœ¬å¹²ä¸äº†åˆ«çš„ï¼‰ã€‚

```sh
# å¯é€‰é¡¹
yarn test
```

4. å¼€å§‹æœ¬åœ° `build`ã€‚è¿™ä¼šäº Â `build`Â  æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶ï¼Œè¿™é‡Œçš„æ„å»ºé€‰é¡¹æ˜¯é€‰æ‹©æ„å»ºåŸºæœ¬çš„ä¸‰ä¸ªåŒ…ï¼š`react`ã€`react-dom`ã€`scheduler`ã€‚

```sh
yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE
```

- _æ„å»ºé¡ºåˆ©å®Œæˆåï¼Œä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š_

  ![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50c0c3636f444e64b39de0a5b3920623~tplv-k3u1fbpfcp-watermark.image?)

- _å¯ä»¥å‘ç°æ‰“åŒ…å¥½çš„ä»£ç æ–‡ä»¶æ”¾åœ¨äº†æ–°å¢çš„ `build/` æ–‡ä»¶å¤¹ä¸‹ï¼Œ å¹¶ä¸”`build/node_modules/react/cjs` ç›®å½•ä¸‹ç”Ÿæˆäº† `CJS` æ¨¡å—åŒ–è§„èŒƒçš„æ‰“åŒ…æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š_

  ![tempsnip.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d59543d23534f1195b2cd0e3cc2993e~tplv-k3u1fbpfcp-watermark.image?)

* **\*å¯é€‰æ‰“åŒ…æ–‡ä»¶ç±»å‹ï¼š** å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `--type=UMD` æ–¹å¼æ¥æ„å»º `UMD` æ¨¡å—åŒ–è§„èŒƒçš„æ‰“åŒ…æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ `script` æ ‡ç­¾æ¥åœ¨ `HTML` æ–‡ä»¶ä¸­å¼•ç”¨æ¥ä½¿ç”¨ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†æµ‹è¯•ç”¨çš„ `HTML` æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š\*

```sh
yarn build react/index,react-dom/index --type=UMD
# ç„¶åæ‰¾åˆ°æ‰“å¼€æºç ä¸­çš„ HTML æµ‹è¯•æ–‡ä»¶
fixtures/packaging/babel-standalone/dev.html
```

- _`fixtures/packaging/babel-standalone/dev.html` ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­å¼•ç”¨äº†æ„å»ºååœ¨ `build/node_modules/react/umd` ç›®å½•ä¸‹ç”Ÿæˆçš„ `UMD` æ¨¡å—åŒ–è§„èŒƒæ‰“åŒ…æ–‡ä»¶ï¼š_

  ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c649e64db344aff91dc2520ce4c91f8~tplv-k3u1fbpfcp-watermark.image?)

5. ä½¿ç”¨ `creact-react-app` è„šæ‰‹æ¶æ¥å¿«é€Ÿåˆ›å»ºè‡ªå·±çš„ React é¡¹ç›®ï¼š

```sh
# è¿”å› react æºç åŒçº§ç›®å½•ï¼Œåˆå§‹åŒ–è‡ªå·±çš„åº”ç”¨
cd ..
# ç»™è‡ªå·±åº”ç”¨å‘½å my-app
npx create-react-app my-app
```

5. ä¸ºäº†åœ¨è‡ªå·±åº”ç”¨ä¸­èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬ä¸Šä¸€æ­¥åœ¨æœ¬åœ°æ„å»ºå¥½çš„æºç  `npm` åŒ…ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ `yarn link` ä¿®æ”¹ä¾èµ–é¡¹çš„è½¯è¿æ¥æŒ‡å‘æ¥è®©å…¶ç”Ÿæ•ˆã€‚

```sh
# è¿›å…¥æºç é¡¹ç›® react è·¯å¾„
cd react
cd build/node_modules/react
yarn link
cd build/node_modules/react-dom
yarn link

# è¿›å…¥æˆ‘ä»¬è‡ªå·±åº”ç”¨ my-app è·¯å¾„
cd my-app
yarn link react react-dom
# ç¼–è¯‘å¯åŠ¨
npm start
```

6. æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹æºç å¢åŠ æ‰“å°è¾“å‡ºï¼Œç„¶åé‡æ–° `npm start` å¯åŠ¨æˆ‘ä»¬é¡¹ç›®æ¥éªŒè¯ä¸‹æ•ˆæœã€‚

   _ä¿®æ”¹ `react/build/node_modules/react/cjs/react.development.js` ï¼š_

   ![tempsnip-1.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31cdefb0336949e285e5425603c7fa10~tplv-k3u1fbpfcp-watermark.image?)

   ä¿®æ”¹ `react/build/node_modules/react-dom/cjs/react-dom.development.js` ï¼š

   ![tempsnip-3.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8711248c32a4ecea15c4342db0998df~tplv-k3u1fbpfcp-watermark.image?)

   ğŸ‘ å¯ä»¥çœ‹åˆ°ï¼Œåˆšåˆšä¿®æ”¹çš„æºç å·²ç»ç”Ÿæ•ˆï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹éšæ„ä¿®æ”¹è°ƒè¯•æºç äº†ã€‚

   ![tempsnip-console.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bacf0a1540974588992c05986c38c7e8~tplv-k3u1fbpfcp-watermark.image?)

# è¡¥å……ï¼šbuild æŠ¥é”™ä¿®å¤

åœ¨ `yarn` å®‰è£…ä¾èµ–è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°æŠ¥é”™å¦‚ä¸‹, æç¤ºæ‰¾ä¸åˆ° `autoreconf`:

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/598dc8d7138a4800817412be5fd2d67f~tplv-k3u1fbpfcp-watermark.image?)

**è§£å†³ï¼š** å®‰è£…æŠ¥é”™æç¤ºç¼ºå°‘çš„ä¾èµ–ï¼Œç„¶åå†æ¬¡ `yarn`ï¼š

```sh
sudo apt-get install autoconf automake libtool
yarn
```

# ç›¸å…³èµ„æ–™

å®˜æ–¹ç¤¾åŒºé‡Œä¹Ÿæœ‰å¾ˆå¤šæºç åˆ†æç›¸å…³çš„åšå®¢æ–‡ç« ã€‚

1. å¼ºçƒˆæ¨è Dan ç¥çš„ä¸ªäººåšå®¢ï¼Œç½‘å€åç§° overreacted ä¹Ÿå¾ˆæœ‰æ„æ€: https://overreacted.io
2. Behind the Scenes: Improving the Repository Infrastructure:<https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html>
3. Sneak Peek: Beyond React 16: <https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html>
4. å…³äº Monorepo: https://mp.weixin.qq.com/s/U8_30S9B0S_SU3jdgUxFGQ
5. ï¼ˆè‡ªå·±æ­å»ºä¸€ä¸ª React æ¡†æ¶ï¼‰Build your own React: https://pomb.us/build-your-own-react/
