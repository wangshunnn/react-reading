# ã€Šå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿã€‹

![index.png](./img/dan_blog_1.png)

## å‰è¨€

æœ¬ç¯‡æ˜¯ Dan ç¥åšå®¢[ã€ŠHow Are Function Components Different from Classes?ã€‹](https://overreacted.io/how-are-function-components-different-from-classes/)çš„ç¬”è®°å’Œè¯»åæ„Ÿã€‚å½“ç„¶ï¼Œä¹Ÿå¼ºçƒˆå®‰åˆ© Dan ç¥åšå®¢çš„å…¶ä»–æ–‡ç« ï¼ˆæŒ‡è·¯ï¼š[ğŸ”— overreacted.io](https://overreacted.io/)ï¼‰ï¼Œéƒ½å¾ˆç²¾è¾Ÿï¼Œä»¥åä¹Ÿä¼šå¤šå°½é‡å†™äº›åšå®¢ç¬”è®°æ¥åŠ æ·±ç†è§£ã€‚Shout out to Dan ç¥ ğŸ«¡

## å…ˆè¯´ç»“è®º

> `å¿ƒæ™ºæ¨¡å‹ï¼ˆMental Modelï¼‰ä¸ä¸€æ ·ã€‚`

æˆ‘ç†è§£çš„å¿ƒæ™ºæ¨¡å‹å·®å¼‚æ¥æºäºèƒŒåçš„`ç¼–ç¨‹èŒƒå¼ï¼ˆparadiamsï¼‰`æ‰€è‡´ï¼Œç±»ç»„ä»¶æ˜¯`é¢å‘å¯¹è±¡ç¼–ç¨‹`æ€æƒ³ï¼ˆObject Oriented Programming, `OOP`ï¼‰ï¼Œè€Œå‡½æ•°å¼ç»„ä»¶æ˜¯`å‡½æ•°å¼ç¼–ç¨‹`æ€æƒ³ï¼ˆFunctional Programming, `FP`ï¼‰ï¼Œç¼–ç¨‹èŒƒå¼ä¸åŒå¯¼è‡´äº†å¿ƒæ™ºæ¨¡å‹çš„å·®å¼‚ã€‚

ä¸¤ç§ç¼–ç¨‹èŒƒå¼ç†Ÿå¥½ç†Ÿåï¼Œæˆ‘è§‰å¾—ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºï¼Œä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œå’±ä¹Ÿä¸æ•¢è¯´ã€‚ä» React æ¨å‡ºå‡½æ•°å¼ç»„ä»¶ä»¥åŠ Hooks çš„è¶‹åŠ¿æ¥çœ‹ï¼Œæœªæ¥ React çš„å‘å±•æ–¹å‘è‚¯å®šæ˜¯ç»§ç»­è·µè¡Œå‡½æ•°å¼ç¼–ç¨‹ã€‚

è¯´åˆ°è¿™é‡Œï¼Œå¯ä»¥æ’æ’­ä¸€æ¡å†å²æ•…äº‹ï¼Œ æ˜¯æˆ‘åœ¨ Vue ä½œè€…å°¤é›¨æºªçš„ä¸€ä¸ªçŸ¥ä¹å›ç­”é‡Œçœ‹åˆ°çš„ï¼šâ€œè®¾è®¡å‡º React çš„ Jordan Walker æ˜¯ä¸ª Ocaml è„‘æ®‹ç²‰ï¼ŒçœŸç›¸å¤§ç™½äº†â€ã€‚Ocaml æ˜¯ Caml ç¼–ç¨‹è¯­è¨€çš„ä¸»è¦å®ç°ï¼Œè€Œ Caml åˆæ˜¯åŸºäºå‡½æ•°å¼ç¼–ç¨‹ FP è¯­è¨€ã€‚è¯´æ˜ React ä»ä¸€å¼€å§‹è®¾è®¡å‡ºæ¥å°±ä¸€ç›´åœ¨è·µè¡Œå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ï¼Œç ´æ¡ˆäº†:)ã€‚

> `å‡½æ•°å¼ç»„ä»¶èƒ½æ•è·æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€‚`

ç¼–ç¨‹èŒƒå¼å¿ƒæ™ºæ¨¡å‹å…¶å®æ‰¯çš„æœ‰ç‚¹è¿œï¼Œè½åˆ°å…·ä½“è¡¨ç°æ¥è®²ï¼Œæœ‰ä¸ªå…¸å‹çš„åŒºåˆ«åœ¨äºï¼š`å‡½æ•°å¼ç»„ä»¶èƒ½æ•è·æ¸²æŸ“æ‰€ç”¨çš„å€¼`ã€‚åŸæ–‡æ˜¯â€œ`Function components capture the rendered values`â€ï¼ŒDan è®¤ä¸ºè¿™æ˜¯åœ¨è¿‡å»ä¸€ç›´å­˜åœ¨ä½†å®¹æ˜“è¢«å¿½è§†çš„æœ€å¤§åŒºåˆ«ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»ä¸€ä¸ªå…·ä½“çš„åœºæ™¯ç¤ºä¾‹æ¥è§£è¯»è¿™å¥è¯çš„å«ä¹‰ã€‚

## åœºæ™¯ Demo

`åœºæ™¯`ï¼šå®ç°ä¸€ä¸ªå…³æ³¨æé†’ç»„ä»¶ï¼Œç‚¹å‡»å…³æ³¨ Follow æŒ‰é’®ï¼Œå»¶æ—¶ 3 ç§’é’Ÿåä¼šå¼¹å‡ºæ˜¾ç¤ºè¢«å…³æ³¨äº†çš„ç”¨æˆ·çš„åå­—ï¼ˆprops.userï¼‰ï¼Œæ¯”å¦‚ç‚¹å‡»å…³æ³¨ Dan ä¼šæç¤ºã€ŒFollowed Danã€ã€‚

ä»¥ä¸‹ä¸¤ç§ç»„ä»¶çš„å®ç°ï¼š

### å‡½æ•°å¼ç»„ä»¶

```js
function ProfilePage(props) {
  const showMessage = () => {
    alert('Followed ' + props.user);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return <button onClick={handleClick}>Follow</button>;
}
```

### ç±»ç»„ä»¶

```js
class ProfilePage extends React.Component {
  showMessage = () => {
    alert('Followed ' + this.props.user);
  };

  handleClick = () => {
    setTimeout(this.showMessage, 3000);
  };

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```

ä»¥ä¸Šä¸¤ç§ç»„ä»¶å®ç°æ–¹å¼ä¹çœ‹ä¸€æ ·ï¼Œä½†å®é™…ä¸Šå´æœ‰ä¸ªå‘@\_@ã€‚

å‘åœ¨å“ªå‘¢ï¼Ÿè®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå½“ä½ åœ¨æˆ‘çš„ä¸»é¡µä¸­å…³æ³¨äº†æˆ‘ï¼Œ`props.user` ç­‰äºæˆ‘çš„åå­— `callmeSoon` æ¯«æ— ç–‘é—®ï¼Œä½†ç´§æ¥ç€ä½ ç«‹åˆ»è·³åˆ°äº† Dan çš„ä¸»é¡µï¼Œè¿™æ—¶å€™ `props.user` å…¶å®å·²ç»æ›´æ–°æˆ `Dan` äº†ï¼Œè¿‡äº† 3 ç§’ç§åï¼Œå¼¹çª—ä¼šæç¤ºä½ å…³æ³¨äº†è°å‘¢ï¼Ÿ

- å‡½æ•°å¼ç»„ä»¶ï¼š`ã€ŒFollowed callmeSoonã€`ï¼ˆâœ… ç¬¦åˆé¢„æœŸï¼‰

- ç±»ç»„ä»¶ï¼š`ã€ŒFollowed Danã€`ï¼ˆâŒ ä¸ç¬¦åˆé¢„æœŸï¼Œä½ å¹¶æ²¡æœ‰å…³æ³¨ Danï¼‰

æ›´å¤šç»†èŠ‚å¯ä»¥åœ¨è¿™ä¸ª[ ğŸ”—CodeSandbox Demo ](https://codesandbox.io/s/pjqnl16lm7?file=/src/index.js)é‡Œæµ‹è¯•ã€‚

## é—­åŒ… closure

ä¸Šé¢åœºæ™¯ä¸­ä¸¤ç§ç»„ä»¶ä¹‹æ‰€ä»¥ä¼šæœ‰ä¸åŒåœ°è¡¨ç°ï¼Œæ˜¯å› ä¸ºå‡½æ•°å¼ç»„ä»¶åˆ©ç”¨`é—­åŒ… closure `ç‰¹æ€§è·å–åˆ°çš„ `props.user` ä¸ä¼šæ”¹å˜ï¼Œå§‹ç»ˆæ˜¯ç‚¹å‡»å…³æ³¨æ—¶å€™çš„ç”¨æˆ·ï¼Œè€Œç±»ç»„ä»¶ä¸­ `this` æ°¸è¿œæ˜¯ä¸€ç›´å˜åŒ–çš„ï¼Œæ‰€ä»¥ `this.props.user` å§‹ç»ˆæ˜¯å½“å‰æœ€æ–°çš„ç”¨æˆ·ä½†ä¸ä¸€å®šæ˜¯ 3 ç§’å‰ç‚¹å‡»å…³æ³¨çš„ç”¨æˆ·ã€‚

æ›´æŠ½è±¡ä¸€ç‚¹ï¼Œå¯ä»¥è¯´ã€Œä¸€ä¸ªæ˜¯`immutableä¸å¯å˜çš„`ï¼Œä¸€ä¸ªæ˜¯`mutableå¯å˜çš„`ã€ã€‚

é—­åŒ…é€šå¸¸ä¼šè¢«é¿å…ä½¿ç”¨çš„ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯å¾ˆéš¾å»ç…§é¡¾é‚£äº›ä¼šéšæ—¶é—´å˜åŒ–çš„å˜é‡ï¼Œ`but` ä½†æ˜¯ï¼Œåœ¨ `React` ä¸­ `props` å’Œ `state` éƒ½æ˜¯ `immutable` ä¸å¯å˜çš„ï¼Œä¸ç”¨æ‹…å¿ƒé—­åŒ…çš„è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è¯´`é—­åŒ…`å’Œ React çš„ `immutable` ç†å¿µå…¶å®æ˜¯ä¸€è‡´çš„ã€‚

å†æ‰¯è¿œç‚¹ï¼Œæˆ‘è§‰å¾— React çš„ `immutability` æ•°æ®ä¸å¯å˜ç†å¿µä¹Ÿæ˜¯å› ä¸ºèƒŒåå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³çš„ç¼˜æ•…å§ï¼Œ`immutability` ä¹Ÿæ­£æ˜¯ `React` çœŸæ­£ä¸ `Vue` ç­‰å…¶ä»–å»ºç«‹åœ¨ `mutability` åŸºç¡€ä¸Šæ¡†æ¶çš„æœ€å¤§åŒºåˆ«ï¼ˆè¿™ä¸€ç‚¹ Dan ä¹Ÿæ›¾åœ¨é‡‡è®¿ä¸­æè¿‡ï¼‰ï¼Œä½†è¿™ä¸ªä¹Ÿæ— æ‰€è°“å¯¹é”™ï¼Œåªæ˜¯é“ä¸åŒï¼Œä¸ç›¸...æå¹¶è®ºäº†ï¼ˆdogeï¼‰ã€‚

_è¯´åˆ°è¿™é‡Œï¼Œä¹Ÿå°±èƒ½è§£é‡Šå¼€å¤´çš„ç»“è®ºäº†ï¼š`ã€Œå‡½æ•°å¼ç»„ä»¶èƒ½æ•è·æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€`â€”â€”å› ä¸º`é—­åŒ…ç‰¹æ€§`ã€‚_

å½“ç„¶ï¼Œè¦åœ¨è¿™é‡Œè¯´æ˜çš„æ˜¯ï¼Œå‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶ä¸¤ç§ä¸åŒè¡¨ç°æœ¬äº‹å¹¶ä¸æ˜¯äº’æ–¥çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨é—­åŒ…æ•è·çš„æ–¹æ³•åœ¨ç±»ç»„ä»¶å®ç°ç±»ä¼¼å‡½æ•°å¼ç»„ä»¶çš„è¡¨ç°ï¼Œä¹Ÿå¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­é€šè¿‡ useRef æ¥å®æ—¶æ•è·æœ€æ–°çš„å€¼ã€‚

## ç±»ç»„ä»¶ä¸­æ‰‹åŠ¨é—­åŒ…æ•è· -> å‡½æ•°å¼ç»„ä»¶

åœ¨ç±»ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡æ‰‹åŠ¨é—­åŒ…æ•è·çš„æ–¹å¼æ¥æ•è·æ¸²æŸ“æ‰€ç”¨çš„å€¼ï¼Œè¾¾åˆ°å‡½æ•°å¼ç»„ä»¶æ•ˆæœã€‚

```js
class ProfilePage extends React.Component {
  showMessage = (user) => {
    alert('Followed ' + user);
  };

  handleClick = () => {
    // æ•è·æ¸²æŸ“æ‰€ç”¨çš„props
    const props = this.props;
    setTimeout(() => this.showMessage(props.user), 3000);
  };

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```

## å‡½æ•°å¼ç»„ä»¶ useRef -> ç±»ç»„ä»¶

åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ `useRef` çš„ Hook èƒ½åŠ›æ¥è¿½è¸ªæœ€æ–°çš„å€¼ï¼Œè¾¾åˆ°ç±»ç»„ä»¶çš„æ•ˆæœã€‚å¯ä»¥æŠŠ `something.current` çœ‹ä½œ `this.something` çš„é•œåƒã€‚

```js
function ProfilePage(props) {
  // ä¿æŒè¿½è¸ªæœ€æ–°çš„å€¼
  const latestUser = useRef('');
  useEffect(() => {
    latestUser.current = props.user;
  });

  const showMessage = () => {
    alert('Followed ' + latestUser.current);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return <button onClick={handleClick}>Follow</button>;
}
```

## æ€»ç»“

ä¸Šé¢æˆ‘ä»¬è§£é‡Šäº†ä»€ä¹ˆæ˜¯`ã€Œå‡½æ•°å¼ç»„ä»¶èƒ½æ•è·æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€`ï¼Œé™¤äº†`what`è¿˜éœ€è¦æ€è€ƒ`why`ï¼Œä¸ºä»€ä¹ˆ React è¦è¿™ä¹ˆè®¾è®¡ï¼Ÿå…¶å®æ˜¯ React èƒŒå`immutability`å’Œ`å‡½æ•°å¼ç¼–ç¨‹`çš„è®¾è®¡ç†å¿µä½¿ç„¶ï¼Œå‡½æ•°å¼ç»„ä»¶çš„è¿™ä¸ªç‰¹æ€§èƒ½åœ¨å¾ˆå¤šåœºæ™¯ä¸­è¡¨ç°ç¬¦åˆé¢„æœŸï¼Œè€Œä¸”èƒ½æ›´æ–¹ä¾¿åœ¨`å¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰`ä¸‹ä¾¿ç¼–å†™ä»£ç ï¼Œæ‰€ä»¥ React é€‰æ‹©äº†å®ƒä½œä¸ºé»˜è®¤è¡Œä¸ºè¡¨ç°ä¹Ÿæ˜¯åˆç†çš„ã€‚

å½“ç„¶é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ï¼Œå‡½æ•°å¼ç»„ä»¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨éœ€è¦è¿½è¸ªæœ€æ–°å˜åŒ–å€¼çš„æ—¶å€™è¿˜æ˜¯éœ€è¦è§£å†³ ref èƒ½åŠ›ï¼Œç±»ç»„ä»¶åŒç†ã€‚**ä½†è¿™å¹¶ä¸æ˜¯å¯¹æ–¹çš„ bugï¼Œè€Œæ˜¯å„è‡ªçš„ç‰¹æ€§ã€‚**

æœ€åï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨`React`çš„å¼€å‘è€…æ¥è¯´ï¼Œæ˜ç™½å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶ä¹‹é—´çš„`å¿ƒæ™ºæ¨¡å‹å·®å¼‚`èƒ½å¤Ÿæ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬ codingã€‚_åœ¨ç¼–å†™å‡½æ•°å¼ç»„ä»¶æ—¶æœ‰ä¸€æ¡å¾ˆé‡è¦çš„å¿ƒæ™ºè§„åˆ™å°±æ˜¯â€œå†™ä»£ç æ—¶è¦è®¤ä¸ºä»»ä½•å€¼éƒ½å¯ä»¥éšæ—¶æ›´æ”¹â€ï¼ˆåŸæ–‡ï¼šThe best mental rule Iâ€™ve found so far with hooks is â€code as if any value can change at any timeâ€ï¼‰ã€‚_

1. [ã€Šhow-are-function-components-different-from-classesã€‹- Dan](https://overreacted.io/how-are-function-components-different-from-classes/)
2. [Vue å’Œ React çš„è¿™ä¸ªè¡Œä¸ºå„æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘ï¼Ÿ - é»„ç„çš„å›ç­” - çŸ¥ä¹ ](https://www.zhihu.com/question/543057656/answer/2575930077)
3. [React.js åˆ°åº•æ˜¯è¿åˆéƒ¨åˆ†äººå£å‘³è¿˜æ˜¯çœŸçš„æ˜¯è‡ªç„¶è€Œç„¶äº§ç”Ÿçš„ï¼Ÿ - å°¤é›¨æºªçš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/35935368/answer/65237347)
